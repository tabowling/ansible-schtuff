- hosts: all
  become: yes
  become_method: sudo
  become_user: root

# Assumes you are using RHEL System Roles
#   yum install --enablerepo=rhel-7-server-ansible-2-rpms rhel-system-roles ansible
# Assumes firewall role from galaxy
#   ansible-galaxy install linux-system-roles.firewall

  vars:
    USE_FIREWALL: 1

  tasks:

    - name: Install common Cockpit components 
      yum: 
        name: cockpit, cockpit-system, cockpit-pcp, cockpit-storaged, cockpit-packagekit
        state: latest
      when: ansible_distribution == "Fedora" or
        ( ansible_distribution_major_version > "7" and
          ( ansible_distribution == "CentOS" or ansible_distribution == "RedHat" ))


    - name: Install latest Cockpit components
      yum: 
        name: cockpit-session-recording
        state: latest
      when: ansible_distribution == "Fedora" or
        ( ansible_distribution_major_version > "8" and
          ( ansible_distribution == "CentOS" or ansible_distribution == "RedHat" ))


    - name: Configure Firewall for Cockpit
      include_role:
        name: linux-system-roles.firewall
      vars:
        firewall:
          service: cockpit
          state: enabled
      when: USE_FIREWALL

    - name: Enable and Start Cockpit service
      service:
        name: cockpit.socket
        enabled: yes
        state: started



